generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ProductType {
  FABRIC
  READY_MADE
  CAP
  SHOE
  SERVICE
}

enum ProductStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum LengthUnit {
  METER
  YARD
  PIECE
}

model Category {
  id        String     @id @default(uuid())
  name      String     @db.VarChar(120)
  slug      String     @unique @db.VarChar(140)
  parentId  String?
  parent    Category?  @relation("CategoryParent", fields: [parentId], references: [id], onDelete: SetNull)
  children  Category[] @relation("CategoryParent")

  products  Product[]  @relation("ProductCategories")

  isActive  Boolean    @default(true)
  sortOrder Int        @default(0)

  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@index([parentId])
  @@index([isActive, sortOrder])
}

model Product {
  id          String        @id @default(uuid())
  type        ProductType
  status      ProductStatus @default(DRAFT)

  title       String        @db.VarChar(180)
  slug        String        @unique @db.VarChar(200)
  description String?
  currency    String        @default("NGN") @db.VarChar(8)
  basePrice   Decimal?      @db.Decimal(12, 2)

  attributes  Json?
  isFeatured  Boolean       @default(false)

  images      ProductImage[]
  variants    ProductVariant[]
  categories  Category[]    @relation("ProductCategories")

  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([type, status])
  @@index([status, isFeatured])
}

model ProductImage {
  id        String  @id @default(uuid())
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  url       String
  altText   String? @db.VarChar(160)
  sortOrder Int     @default(0)

  createdAt DateTime @default(now())

  @@index([productId, sortOrder])
}

model ProductVariant {
  id        String  @id @default(uuid())
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  title     String? @db.VarChar(160)
  sku       String? @unique @db.VarChar(80)

  size      String? @db.VarChar(40)
  color     String? @db.VarChar(40)

  unit      LengthUnit?
  minQty    Decimal? @db.Decimal(10, 2)
  qtyStep   Decimal? @db.Decimal(10, 2)

  price     Decimal  @db.Decimal(12, 2)
  isActive  Boolean  @default(true)

  inventory Inventory?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([productId, isActive])
  @@index([size, color])
}

model Inventory {
  id        String         @id @default(uuid())
  variantId String         @unique
  variant   ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  quantity  Int            @default(0)
  reserved  Int            @default(0)
  lowStockAt Int           @default(5)

  updatedAt DateTime       @updatedAt
}
